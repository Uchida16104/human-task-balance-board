<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HumanTask Balance Board</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Alpine -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- HTMX -->
<script src="https://unpkg.com/htmx.org@2.0.4"></script>

<!-- hyperscript -->
<script src="https://unpkg.com/hyperscript.org@0.9.12"></script>

<!-- Motion One -->
<script src="https://unpkg.com/@motionone/dom/dist/motion-one.min.js"></script>

<!-- AOS -->
<link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css">
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

<!-- Swiper -->
<link rel="stylesheet" href="https://unpkg.com/swiper@11/swiper-bundle.min.css">
<script src="https://unpkg.com/swiper@11/swiper-bundle.min.js"></script>

<!-- Shoelace -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/dist/themes/light.css">
<script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/dist/shoelace.js"></script>

<!-- Iconify -->
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

<!-- Mermaid -->
<script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>

<!-- Lottie -->
<script src="https://unpkg.com/lottie-web@5.12.2/build/player/lottie.min.js"></script>

<!-- PouchDB -->
<script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>

<script src="auth/basic-auth.js"></script>

<script src="storage/indexeddb.js"></script>

<script src="storage/local.js"></script>

<script src="storage/pouch.js"></script>

</head>

<body class="bg-slate-50 text-slate-800"
      x-data="app()"
      x-init="init()">

<header class="p-4 bg-white shadow">
  <h1 class="text-xl font-bold flex items-center gap-2">
    <span class="iconify" data-icon="mdi:heart-outline"></span>
    HumanTask Balance Board
  </h1>
</header>

<main class="p-6 space-y-6 max-w-2xl mx-auto">

<!-- Mood -->
<section data-aos="fade-up">
  <label class="block mb-1 font-medium">Mood Check</label>
  <select x-model="mood"
          @change="persist()"
          class="border p-2 rounded w-full">
    <option>Low</option>
    <option>Normal</option>
    <option>High</option>
  </select>
</section>

<!-- Add Task -->
<section data-aos="fade-up">
  <input x-model="taskInput"
         placeholder="New task"
         class="border p-2 rounded w-full">

  <button @click="addTask"
          class="mt-2 px-4 py-2 bg-blue-600 text-white rounded">
    Add Task
  </button>
</section>

<!-- Task List -->
<section>
  <ul class="space-y-2">
    <template x-for="task in tasks" :key="task.id">
      <li class="p-3 bg-white rounded shadow flex items-center justify-between gap-2">

        <!-- View Mode -->
        <div x-show="!task.editing" class="flex-1">
          <span x-text="task.text"></span>
        </div>

        <!-- Edit Mode -->
        <div x-show="task.editing" class="flex-1">
          <input x-model="task.text"
                 class="border p-1 rounded w-full">
        </div>

        <!-- Actions -->
        <div class="flex gap-1 shrink-0">

          <!-- Edit -->
          <button x-show="!task.editing"
                  @click="editTask(task)"
                  class="px-2 py-1 text-sm bg-slate-200 rounded">
            Edit
          </button>

          <!-- Save -->
          <button x-show="task.editing"
                  @click="saveTask(task)"
                  class="px-2 py-1 text-sm bg-green-600 text-white rounded">
            Save
          </button>

          <!-- Cancel -->
          <button x-show="task.editing"
                  @click="cancelEdit(task)"
                  class="px-2 py-1 text-sm bg-gray-400 text-white rounded">
            Cancel
          </button>

          <!-- Delete -->
          <button @click="deleteTask(task.id)"
                  class="px-2 py-1 text-sm bg-red-600 text-white rounded">
            Delete
          </button>

        </div>
      </li>
    </template>
  </ul>
</section>

<!-- Diagram -->
<section>
<div class="mermaid">
graph TD
Mood --> Tasks
Tasks --> Balance
</div>
</section>

<!-- Lottie -->
<section>
<div id="lottie" style="width:120px;height:120px"></div>
</section>

</main>

<script>
function app() {
  return {
    mood: "Normal",
    taskInput: "",
    tasks: [],
    db: null,
    snapshot: {},

    init() {
      AOS.init();
      mermaid.initialize({ startOnLoad: true });
      this.db = new PouchDB("humantask-local");

      const saved = JSON.parse(localStorage.getItem("state") || "{}");
      this.mood = saved.mood || this.mood;
      this.tasks = (saved.tasks || []).map(t => ({
        ...t,
        editing: false
      }));

      lottie.loadAnimation({
        container: document.getElementById("lottie"),
        renderer: "svg",
        loop: true,
        autoplay: true,
        path: "https://assets10.lottiefiles.com/packages/lf20_jcikwtux.json"
      });
    },

    persist() {
      localStorage.setItem("state", JSON.stringify({
        mood: this.mood,
        tasks: this.tasks.map(({ editing, ...t }) => t)
      }));
    },

    addTask() {
      if (!this.taskInput) return;
      this.tasks.push({
        id: Date.now(),
        text: this.taskInput,
        editing: false
      });
      this.taskInput = "";
      this.persist();
    },

    deleteTask(id) {
      this.tasks = this.tasks.filter(t => t.id !== id);
      this.persist();
    },

    editTask(task) {
      this.snapshot[task.id] = task.text;
      task.editing = true;
    },

    saveTask(task) {
      task.editing = false;
      this.persist();
    },

    cancelEdit(task) {
      task.text = this.snapshot[task.id];
      task.editing = false;
    }
  };
}
</script>
<script src="app.js"></script>

</body>
</html>
